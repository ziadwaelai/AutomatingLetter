2025-10-29 09:45:19,673 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-10-29 09:45:19,748 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.11:5000
2025-10-29 09:45:19,748 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-29 09:45:19,749 - werkzeug - INFO -  * Restarting with stat
2025-10-29 09:45:25,002 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-10-29 09:45:25,030 - werkzeug - WARNING -  * Debugger is active!
2025-10-29 09:45:25,035 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-10-29 09:45:36,883 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\api\\whatsapp_routes.py', reloading
2025-10-29 09:45:37,120 - werkzeug - INFO -  * Restarting with stat
2025-10-29 09:45:41,074 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-10-29 09:45:41,143 - werkzeug - WARNING -  * Debugger is active!
2025-10-29 09:45:41,146 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-10-29 09:45:44,821 - __main__ - INFO - GET http://localhost:5000/api/v1/submissions?page=1&page_size=10&sort_by=ID&sort_order=desc - 127.0.0.1
2025-10-29 09:45:44,824 - src.api.submissions_routes - INFO - Submissions query request from user: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-10-29 09:45:47,939 - src.api.submissions_routes - INFO - Found 2 submissions in sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-10-29 09:45:47,939 - src.api.submissions_routes - INFO - Returning page 1 of 1 with 2 submissions
2025-10-29 09:45:47,940 - src.utils.helpers - INFO - get_submissions executed in 3.118s
2025-10-29 09:45:47,941 - __main__ - INFO - Response: 200 - submissions.get_submissions
2025-10-29 09:45:47,942 - werkzeug - INFO - 127.0.0.1 - - [29/Oct/2025 09:45:47] "GET /api/v1/submissions?page=1&page_size=10&sort_by=ID&sort_order=desc HTTP/1.1" 200 -
2025-10-29 09:46:41,931 - __main__ - INFO - GET http://localhost:5000/api/v1/letter/LET-20251028-12345 - 127.0.0.1
2025-10-29 09:46:41,932 - src.api.letter_routes - INFO - Letter retrieval request: LET-20251028-12345 by user: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-10-29 09:46:44,405 - actions.letter.retrieval - INFO - Get letter successful | User: ziad@moe.gov.sa | {"letter_id": "LET-20251028-12345", "letter_type": "\u062f\u0639\u0648\u0629", "recipient": "\u0623\u062d\u0645\u062f \u0645\u062d\u0645\u062f"}
2025-10-29 09:46:44,405 - src.api.letter_routes - INFO - Letter retrieved successfully: LET-20251028-12345
2025-10-29 09:46:44,406 - src.utils.helpers - INFO - get_letter_by_id executed in 2.475s
2025-10-29 09:46:44,407 - __main__ - INFO - Response: 200 - letter.get_letter_by_id
2025-10-29 09:46:44,407 - werkzeug - INFO - 127.0.0.1 - - [29/Oct/2025 09:46:44] "GET /api/v1/letter/LET-20251028-12345 HTTP/1.1" 200 -
2025-10-29 11:51:02,799 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-10-29 11:51:03,028 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.11:5000
2025-10-29 11:51:03,030 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-10-29 11:51:03,035 - werkzeug - INFO -  * Restarting with stat
2025-10-29 11:51:07,208 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-10-29 11:51:07,242 - werkzeug - WARNING -  * Debugger is active!
2025-10-29 11:51:07,248 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-10-29 11:51:53,173 - __main__ - INFO - PUT http://localhost:5000/api/v1/submissions/<submission_id>/review - 127.0.0.1
2025-10-29 11:51:53,175 - src.utils.helpers - WARNING - No authorization token found in request
2025-10-29 11:51:53,175 - src.utils.helpers - INFO - review_submission executed in 0.000s
2025-10-29 11:51:53,175 - __main__ - INFO - Response: 401 - submissions.review_submission
2025-10-29 11:51:53,176 - werkzeug - INFO - 127.0.0.1 - - [29/Oct/2025 11:51:53] "[31m[1mPUT /api/v1/submissions/<submission_id>/review HTTP/1.1[0m" 401 -
2025-10-29 11:51:59,526 - __main__ - INFO - PUT http://localhost:5000/api/v1/submissions/<submission_id>/review - 127.0.0.1
2025-10-29 11:51:59,528 - src.api.submissions_routes - INFO - Review request for submission: <submission_id> by reviewer: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-10-29 11:52:03,113 - src.api.submissions_routes - WARNING - Submission with ID '<submission_id>' not found
2025-10-29 11:52:03,115 - src.utils.helpers - INFO - review_submission executed in 3.588s
2025-10-29 11:52:03,120 - __main__ - INFO - Response: 200 - submissions.review_submission
2025-10-29 11:52:03,121 - werkzeug - INFO - 127.0.0.1 - - [29/Oct/2025 11:52:03] "PUT /api/v1/submissions/<submission_id>/review HTTP/1.1" 200 -
2025-10-29 11:52:34,488 - __main__ - INFO - PUT http://localhost:5000/api/v1/submissions/LET-20251023-1231245/review - 127.0.0.1
2025-10-29 11:52:34,488 - src.api.submissions_routes - INFO - Review request for submission: LET-20251023-1231245 by reviewer: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-10-29 11:52:39,825 - src.api.submissions_routes - INFO - Successfully updated review for submission LET-20251023-1231245: status=Approved, reviewer=ziad@moe.gov.sa
2025-10-29 11:52:39,826 - src.utils.helpers - INFO - review_submission executed in 5.338s
2025-10-29 11:52:39,826 - __main__ - INFO - Response: 200 - submissions.review_submission
2025-10-29 11:52:39,827 - werkzeug - INFO - 127.0.0.1 - - [29/Oct/2025 11:52:39] "PUT /api/v1/submissions/LET-20251023-1231245/review HTTP/1.1" 200 -
2025-10-29 11:54:09,166 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\api\\submissions_routes.py', reloading
2025-10-29 11:54:09,519 - werkzeug - INFO -  * Restarting with stat
2025-10-29 11:54:15,831 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-10-29 11:54:15,877 - werkzeug - WARNING -  * Debugger is active!
2025-10-29 11:54:15,882 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-10-29 11:54:30,511 - __main__ - INFO - PUT http://localhost:5000/api/v1/submissions/LET-20251023-1231245/review - 127.0.0.1
2025-10-29 11:54:30,512 - __main__ - INFO - Response: 404 - None
2025-10-29 11:54:30,513 - werkzeug - INFO - 127.0.0.1 - - [29/Oct/2025 11:54:30] "[33mPUT /api/v1/submissions/LET-20251023-1231245/review HTTP/1.1[0m" 404 -
2025-10-29 11:54:42,518 - __main__ - INFO - PUT http://localhost:5000/api/v1/submissions/review/LET-20251023-1231245 - 127.0.0.1
2025-10-29 11:54:42,519 - src.api.submissions_routes - INFO - Review request for submission: LET-20251023-1231245 by reviewer: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-10-29 11:54:48,379 - src.api.submissions_routes - INFO - Successfully updated review for submission LET-20251023-1231245: status=Approved, reviewer=ziad@moe.gov.sa
2025-10-29 11:54:48,380 - src.utils.helpers - INFO - review_submission executed in 5.860s
2025-10-29 11:54:48,381 - __main__ - INFO - Response: 200 - submissions.review_submission
2025-10-29 11:54:48,382 - werkzeug - INFO - 127.0.0.1 - - [29/Oct/2025 11:54:48] "PUT /api/v1/submissions/review/LET-20251023-1231245 HTTP/1.1" 200 -
2025-11-05 10:34:11,067 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 10:34:11,184 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.11:5000
2025-11-05 10:34:11,186 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-05 10:34:11,195 - werkzeug - INFO -  * Restarting with stat
2025-11-05 10:34:16,329 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 10:34:16,363 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 10:34:16,370 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 10:34:54,903 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/letter/generate - 127.0.0.1
2025-11-05 10:34:54,905 - src.utils.helpers - WARNING - JWT token has expired
2025-11-05 10:34:54,905 - src.utils.helpers - WARNING - Request made with expired JWT token
2025-11-05 10:34:54,905 - src.utils.helpers - INFO - generate_letter executed in 0.001s
2025-11-05 10:34:54,906 - __main__ - INFO - Response: 401 - letter.generate_letter
2025-11-05 10:34:54,908 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 10:34:54] "[31m[1mPOST /api/v1/letter/generate HTTP/1.1[0m" 401 -
2025-11-05 10:35:02,667 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/user/validate - 127.0.0.1
2025-11-05 10:35:05,947 - src.services.user_management_service - INFO - Client found for email ziad@moe.gov.sa: Ministry of Education
2025-11-05 10:35:05,947 - src.utils.helpers - INFO - get_client_by_email executed in 3.279s
2025-11-05 10:35:08,839 - src.services.user_management_service - INFO - User found: ziad@moe.gov.sa in client sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:35:08,841 - src.utils.helpers - INFO - get_user_info executed in 2.892s
2025-11-05 10:35:08,904 - src.services.user_management_service - INFO - User credentials validated successfully: ziad@moe.gov.sa for client Ministry of Education
2025-11-05 10:35:08,904 - src.utils.helpers - INFO - validate_user_credentials executed in 6.236s
2025-11-05 10:35:08,904 - src.api.user_routes - INFO - User validated successfully: ziad@moe.gov.sa
2025-11-05 10:35:08,905 - src.utils.helpers - INFO - validate_user executed in 6.237s
2025-11-05 10:35:08,905 - __main__ - INFO - Response: 200 - user.validate_user
2025-11-05 10:35:08,905 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 10:35:08] "POST /api/v1/user/validate HTTP/1.1" 200 -
2025-11-05 10:35:25,323 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/letter/generate - 127.0.0.1
2025-11-05 10:35:25,323 - src.api.letter_routes - INFO - Letter generation request from user: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:35:27,385 - src.services.usage_tracking_service - INFO - Usage Tracking Service initialized
2025-11-05 10:35:29,586 - src.services.usage_tracking_service - INFO - Found quota_month limit: 100
2025-11-05 10:35:29,586 - src.utils.helpers - INFO - get_quota_limit executed in 2.201s
2025-11-05 10:35:31,506 - src.services.usage_tracking_service - INFO - Found existing usage row for 2025_11 at row 3: {'yyyy_mm': '2025_11', 'letters_count': 3, 'tokens_sum': 8361, 'cost_sum_usd': 0.054525}
2025-11-05 10:35:31,507 - src.utils.helpers - INFO - get_or_create_usage_row executed in 1.920s
2025-11-05 10:35:31,508 - src.services.usage_tracking_service - INFO - Quota check passed: 3/100 (97 remaining)
2025-11-05 10:35:31,508 - src.utils.helpers - INFO - check_quota executed in 4.122s
2025-11-05 10:35:31,508 - src.utils.helpers - INFO - get_client_by_email executed in 0.000s
2025-11-05 10:35:35,265 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 1.800s
2025-11-05 10:35:35,269 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 1.804s
2025-11-05 10:35:35,766 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 2.301s
2025-11-05 10:35:35,827 - src.services.google_services - WARNING - No user found with full_name: 
2025-11-05 10:35:35,828 - src.utils.helpers - INFO - get_user_info_from_sheet_id executed in 2.362s
2025-11-05 10:35:35,829 - src.utils.helpers - INFO - get_letter_config_by_category_from_sheet_id executed in 2.364s
2025-11-05 10:35:35,829 - src.api.letter_routes - INFO - Loaded letter config from sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg for category: Ø·Ù„Ø¨
2025-11-05 10:35:35,830 - src.services.letter_generator - INFO - Using AI model: gpt-4.1
2025-11-05 10:35:35,830 - src.services.letter_generator - INFO - Arabic Letter Generation Service initialized
2025-11-05 10:35:35,830 - src.services.letter_generator - INFO - Attempting to load prompt template from Settings sheet for sheet_id: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:35:37,772 - src.services.usage_tracking_service - INFO - Found prompt template from Settings sheet (length: 7472 chars)
2025-11-05 10:35:37,773 - src.utils.helpers - INFO - get_prompt_template executed in 1.943s
2025-11-05 10:35:37,773 - src.services.letter_generator - INFO - âœ… Successfully loaded custom prompt template from Settings sheet (length: 7472 chars)
2025-11-05 10:35:40,760 - src.utils.helpers - INFO - get_context_instructions executed in 2.434s
2025-11-05 10:35:40,796 - src.services.memory_service - INFO - Optimized memory service initialized (sheet_id: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 10:35:40,832 - src.services.letter_generator - INFO - Retrieved memory instructions for category='Ø·Ù„Ø¨', session_id='None', sheet_id='17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg': 125 chars
2025-11-05 10:35:40,833 - src.services.letter_generator - INFO - Generating letter with ID: LET-20251105-80254
2025-11-05 10:35:41,594 - src.services.letter_generator - ERROR - Letter generation failed for ID LET-20251105-80254: "Input to PromptTemplate is missing variables {'recipient_title'}.  Expected: ['additional_context', 'current_date', 'letter_id', 'member_info', 'memory_instructions', 'previous_letter_info', 'recipient_title', 'reference_context', 'user_prompt', 'writing_instructions'] Received: ['user_prompt', 'reference_context', 'additional_context', 'writing_instructions', 'member_info', 'letter_id', 'current_date', 'previous_letter_info', 'memory_instructions']\nNote: if you intended {recipient_title} to be part of the string and not a variable, please escape it with double curly braces like: '{{recipient_title}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-11-05 10:35:41,594 - src.utils.exceptions - ERROR - Operation failed: letter_generation
2025-11-05 10:35:41,594 - src.utils.helpers - ERROR - generate_letter failed after 5.765s: Failed to generate letter: "Input to PromptTemplate is missing variables {'recipient_title'}.  Expected: ['additional_context', 'current_date', 'letter_id', 'member_info', 'memory_instructions', 'previous_letter_info', 'recipient_title', 'reference_context', 'user_prompt', 'writing_instructions'] Received: ['user_prompt', 'reference_context', 'additional_context', 'writing_instructions', 'member_info', 'letter_id', 'current_date', 'previous_letter_info', 'memory_instructions']\nNote: if you intended {recipient_title} to be part of the string and not a variable, please escape it with double curly braces like: '{{recipient_title}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-11-05 10:35:41,594 - src.api.letter_routes - ERROR - Letter generation failed: AI service error: Failed to generate letter: "Input to PromptTemplate is missing variables {'recipient_title'}.  Expected: ['additional_context', 'current_date', 'letter_id', 'member_info', 'memory_instructions', 'previous_letter_info', 'recipient_title', 'reference_context', 'user_prompt', 'writing_instructions'] Received: ['user_prompt', 'reference_context', 'additional_context', 'writing_instructions', 'member_info', 'letter_id', 'current_date', 'previous_letter_info', 'memory_instructions']\nNote: if you intended {recipient_title} to be part of the string and not a variable, please escape it with double curly braces like: '{{recipient_title}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-11-05 10:35:41,595 - src.utils.helpers - INFO - generate_letter executed in 16.272s
2025-11-05 10:35:41,595 - __main__ - INFO - Response: 500 - letter.generate_letter
2025-11-05 10:35:41,596 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 10:35:41] "[35m[1mPOST /api/v1/letter/generate HTTP/1.1[0m" 500 -
2025-11-05 10:37:27,740 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\api\\__init__.py', reloading
2025-11-05 10:37:28,099 - werkzeug - INFO -  * Restarting with stat
2025-11-05 10:39:50,657 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 10:39:50,704 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.11:5000
2025-11-05 10:39:50,704 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-05 10:39:50,708 - werkzeug - INFO -  * Restarting with stat
2025-11-05 10:39:53,841 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 10:39:54,041 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 10:39:54,041 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 10:39:54,124 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/letter/generate - 127.0.0.1
2025-11-05 10:39:54,124 - src.api.letter_routes - INFO - Letter generation request from user: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:39:54,358 - src.services.usage_tracking_service - INFO - Usage Tracking Service initialized
2025-11-05 10:39:57,698 - src.services.usage_tracking_service - INFO - Found quota_month limit: 100
2025-11-05 10:39:57,699 - src.utils.helpers - INFO - get_quota_limit executed in 3.341s
2025-11-05 10:40:00,057 - src.services.usage_tracking_service - INFO - Found existing usage row for 2025_11 at row 3: {'yyyy_mm': '2025_11', 'letters_count': 3, 'tokens_sum': 8361, 'cost_sum_usd': 0.054525}
2025-11-05 10:40:00,057 - src.utils.helpers - INFO - get_or_create_usage_row executed in 2.359s
2025-11-05 10:40:00,058 - src.services.usage_tracking_service - INFO - Quota check passed: 3/100 (97 remaining)
2025-11-05 10:40:00,058 - src.utils.helpers - INFO - check_quota executed in 5.701s
2025-11-05 10:40:02,938 - src.services.user_management_service - INFO - Client found for email ziad@moe.gov.sa: Ministry of Education
2025-11-05 10:40:02,939 - src.utils.helpers - INFO - get_client_by_email executed in 2.880s
2025-11-05 10:40:06,200 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 1.965s
2025-11-05 10:40:06,689 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 2.452s
2025-11-05 10:40:06,700 - src.services.google_services - WARNING - No user found with full_name: 
2025-11-05 10:40:06,700 - src.utils.helpers - INFO - get_user_info_from_sheet_id executed in 2.463s
2025-11-05 10:40:07,589 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 3.352s
2025-11-05 10:40:07,591 - src.utils.helpers - INFO - get_letter_config_by_category_from_sheet_id executed in 3.355s
2025-11-05 10:40:07,591 - src.api.letter_routes - INFO - Loaded letter config from sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg for category: Ø·Ù„Ø¨
2025-11-05 10:40:07,592 - src.services.letter_generator - INFO - Using AI model: gpt-4.1
2025-11-05 10:40:07,592 - src.services.letter_generator - INFO - Arabic Letter Generation Service initialized
2025-11-05 10:40:07,592 - src.services.letter_generator - INFO - Attempting to load prompt template from Settings sheet for sheet_id: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:40:08,990 - src.services.usage_tracking_service - INFO - Found prompt template from Settings sheet (length: 7365 chars)
2025-11-05 10:40:08,992 - src.utils.helpers - INFO - get_prompt_template executed in 1.401s
2025-11-05 10:40:08,993 - src.services.letter_generator - INFO - âœ… Successfully loaded custom prompt template from Settings sheet (length: 7365 chars)
2025-11-05 10:40:10,219 - src.utils.helpers - INFO - get_context_instructions executed in 0.878s
2025-11-05 10:40:10,230 - src.services.memory_service - INFO - Optimized memory service initialized (sheet_id: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 10:40:10,241 - src.services.letter_generator - INFO - Retrieved memory instructions for category='Ø·Ù„Ø¨', session_id='None', sheet_id='17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg': 125 chars
2025-11-05 10:40:10,242 - src.services.letter_generator - INFO - Generating letter with ID: LET-20251105-28290
2025-11-05 10:40:10,360 - src.services.letter_generator - ERROR - Letter generation failed for ID LET-20251105-28290: "Input to PromptTemplate is missing variables {'recipient_title'}.  Expected: ['additional_context', 'current_date', 'letter_id', 'member_info', 'memory_instructions', 'previous_letter_info', 'recipient_title', 'reference_context', 'user_prompt', 'writing_instructions'] Received: ['user_prompt', 'reference_context', 'additional_context', 'writing_instructions', 'member_info', 'letter_id', 'current_date', 'previous_letter_info', 'memory_instructions']\nNote: if you intended {recipient_title} to be part of the string and not a variable, please escape it with double curly braces like: '{{recipient_title}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-11-05 10:40:10,360 - src.utils.exceptions - ERROR - Operation failed: letter_generation
2025-11-05 10:40:10,360 - src.utils.helpers - ERROR - generate_letter failed after 2.768s: Failed to generate letter: "Input to PromptTemplate is missing variables {'recipient_title'}.  Expected: ['additional_context', 'current_date', 'letter_id', 'member_info', 'memory_instructions', 'previous_letter_info', 'recipient_title', 'reference_context', 'user_prompt', 'writing_instructions'] Received: ['user_prompt', 'reference_context', 'additional_context', 'writing_instructions', 'member_info', 'letter_id', 'current_date', 'previous_letter_info', 'memory_instructions']\nNote: if you intended {recipient_title} to be part of the string and not a variable, please escape it with double curly braces like: '{{recipient_title}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-11-05 10:40:10,361 - src.api.letter_routes - ERROR - Letter generation failed: AI service error: Failed to generate letter: "Input to PromptTemplate is missing variables {'recipient_title'}.  Expected: ['additional_context', 'current_date', 'letter_id', 'member_info', 'memory_instructions', 'previous_letter_info', 'recipient_title', 'reference_context', 'user_prompt', 'writing_instructions'] Received: ['user_prompt', 'reference_context', 'additional_context', 'writing_instructions', 'member_info', 'letter_id', 'current_date', 'previous_letter_info', 'memory_instructions']\nNote: if you intended {recipient_title} to be part of the string and not a variable, please escape it with double curly braces like: '{{recipient_title}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-11-05 10:40:10,361 - src.utils.helpers - INFO - generate_letter executed in 16.237s
2025-11-05 10:40:10,361 - __main__ - INFO - Response: 500 - letter.generate_letter
2025-11-05 10:40:10,361 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 10:40:10] "[35m[1mPOST /api/v1/letter/generate HTTP/1.1[0m" 500 -
2025-11-05 10:42:19,020 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\letter_generator.py', reloading
2025-11-05 10:42:19,277 - werkzeug - INFO -  * Restarting with stat
2025-11-05 10:42:21,623 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 10:42:21,649 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 10:42:21,652 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 10:42:27,682 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/letter/generate - 127.0.0.1
2025-11-05 10:42:27,682 - src.api.letter_routes - INFO - Letter generation request from user: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:42:27,786 - src.services.usage_tracking_service - INFO - Usage Tracking Service initialized
2025-11-05 10:42:30,914 - src.services.usage_tracking_service - INFO - Found quota_month limit: 100
2025-11-05 10:42:30,915 - src.utils.helpers - INFO - get_quota_limit executed in 3.128s
2025-11-05 10:42:32,806 - src.services.usage_tracking_service - INFO - Found existing usage row for 2025_11 at row 3: {'yyyy_mm': '2025_11', 'letters_count': 3, 'tokens_sum': 8361, 'cost_sum_usd': 0.054525}
2025-11-05 10:42:32,806 - src.utils.helpers - INFO - get_or_create_usage_row executed in 1.891s
2025-11-05 10:42:32,806 - src.services.usage_tracking_service - INFO - Quota check passed: 3/100 (97 remaining)
2025-11-05 10:42:32,806 - src.utils.helpers - INFO - check_quota executed in 5.020s
2025-11-05 10:42:35,573 - src.services.user_management_service - INFO - Client found for email ziad@moe.gov.sa: Ministry of Education
2025-11-05 10:42:35,574 - src.utils.helpers - INFO - get_client_by_email executed in 2.767s
2025-11-05 10:42:37,896 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 0.900s
2025-11-05 10:42:38,800 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 1.803s
2025-11-05 10:42:38,859 - src.services.google_services - WARNING - No user found with full_name: 
2025-11-05 10:42:38,859 - src.utils.helpers - INFO - get_user_info_from_sheet_id executed in 1.858s
2025-11-05 10:42:39,509 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 2.508s
2025-11-05 10:42:39,509 - src.utils.helpers - INFO - get_letter_config_by_category_from_sheet_id executed in 2.514s
2025-11-05 10:42:39,509 - src.api.letter_routes - INFO - Loaded letter config from sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg for category: Ø·Ù„Ø¨
2025-11-05 10:42:39,509 - src.services.letter_generator - INFO - Using AI model: gpt-4.1
2025-11-05 10:42:39,510 - src.services.letter_generator - INFO - Arabic Letter Generation Service initialized
2025-11-05 10:42:39,510 - src.services.letter_generator - INFO - Attempting to load prompt template from Settings sheet for sheet_id: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:42:40,365 - src.services.usage_tracking_service - INFO - Found prompt template from Settings sheet (length: 7341 chars)
2025-11-05 10:42:40,365 - src.utils.helpers - INFO - get_prompt_template executed in 0.855s
2025-11-05 10:42:40,366 - src.services.letter_generator - INFO - âœ… Successfully loaded custom prompt template from Settings sheet (length: 7341 chars)
2025-11-05 10:42:42,725 - src.utils.helpers - INFO - get_context_instructions executed in 2.047s
2025-11-05 10:42:42,745 - src.services.memory_service - INFO - Optimized memory service initialized (sheet_id: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 10:42:42,757 - src.services.letter_generator - INFO - Retrieved memory instructions for category='Ø·Ù„Ø¨', session_id='None', sheet_id='17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg': 125 chars
2025-11-05 10:42:42,757 - src.services.letter_generator - INFO - Generating letter with ID: LET-20251105-07703
2025-11-05 10:42:52,311 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 10:42:52,401 - src.services.letter_generator - ERROR - Letter generation failed for ID LET-20251105-07703: Invalid json output: Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…

Ø®Ø·Ø§Ø¨ Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ± Ù„Ø¬Ù‡ÙˆØ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©

Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„ÙØ§Ø¶Ù„ Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ                                                                                   Ø³Ù„Ù…Ù‡ Ø§Ù„Ù„Ù‡

Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ

     Ù†Ø«Ù…Ù† Ø¬Ù‡ÙˆØ¯ÙƒÙ… Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø© ÙÙŠ ØªØ·ÙˆÙŠØ± Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ ÙˆÙ†Ù‚Ø¯Ø± Ø¯ÙˆØ±ÙƒÙ… Ø§Ù„ÙØ§Ø¹Ù„ ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„ØªÙ†Ù…ÙˆÙŠØ© Ø°Ø§Øª Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹.

     ÙˆØ§Ù†Ø·Ù„Ø§Ù‚Ù‹Ø§ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù‡Ø¬ Ø§Ù„Ø·Ù…ÙˆØ­ØŒ Ù†ÙˆØ¯ Ø£Ù† Ù†Ù‚Ø¯Ù… Ù„Ø³Ø¹Ø§Ø¯ØªÙƒÙ… "Ù†Øª Ø²ÙŠØ±Ùˆ"ØŒ ÙˆÙ‡Ùˆ Ù…Ø´Ø±ÙˆØ¹ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ ÙˆØ·Ù†ÙŠØŒ Ø£Ø­Ø¯ Ù…Ø®Ø±Ø¬Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ø¬ (Ø³Ø¯Ø±Ø©) Ø§Ù„ØªØ§Ø¨Ø¹ Ù„ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…ÙŠØ§Ù‡ ÙˆØ§Ù„Ø²Ø±Ø§Ø¹Ø©ØŒ ÙŠÙ‡Ø¯Ù Ø¥Ù„Ù‰ ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© ÙˆØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø­ÙŠØ§Ø¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†ÙŠ ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŒ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ·ÙˆÙŠØ± Ø­Ù„ÙˆÙ„ ØªÙ‚Ù†ÙŠØ© Ù…Ø¨ØªÙƒØ±Ø© ØªØ¯Ø¹Ù… Ø§Ù„ØªØ´Ø¬ÙŠØ± Ø§Ù„Ø°ÙƒÙŠØŒ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ù†Ø¨Ø§ØªÙŠØŒ ÙˆØ±ÙØ¹ ÙƒÙØ§Ø¡Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¨Ù…Ø§ ÙŠÙˆØ§ÙƒØ¨ Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ù…Ù„ÙƒØ© 2030 ÙˆÙ…Ø¨Ø§Ø¯Ø±Ø© "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡".

     Ù†ØªÙ‚Ø¯Ù… Ø¥Ù„Ù‰ Ø³Ø¹Ø§Ø¯ØªÙƒÙ… Ø¨Ø¬Ø²ÙŠÙ„ Ø§Ù„Ø´ÙƒØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ± Ø¹Ù„Ù‰ Ù…Ø§ ØªØ¨Ø°Ù„ÙˆÙ†Ù‡ Ù…Ù† Ø¬Ù‡ÙˆØ¯ Ù…Ù„Ù…ÙˆØ³Ø© ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©ØŒ ÙˆØ­Ø±ØµÙƒÙ… Ø§Ù„Ø¯Ø§Ø¦Ù… Ø¹Ù„Ù‰ ØªØ³Ù‡ÙŠÙ„ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø®ØªØµØ©ØŒ Ù…Ù…Ø§ ÙƒØ§Ù† Ù„Ù‡ Ø¨Ø§Ù„Øº Ø§Ù„Ø£Ø«Ø± ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©. Ø¥Ù† ØªØ¹Ø§ÙˆÙ†ÙƒÙ… Ø§Ù„Ø¨Ù†Ù‘Ø§Ø¡ ÙˆØªÙˆØ¬ÙŠÙ‡Ø§ØªÙƒÙ… Ø§Ù„Ø³Ø¯ÙŠØ¯Ø© Ø£Ø³Ù‡Ù…Ø§ ÙÙŠ ØªØ°Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª ÙˆØªØ¹Ø²ÙŠØ² Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø°ÙŠ Ø§Ù†Ø¹ÙƒØ³ Ø¥ÙŠØ¬Ø§Ø¨Ù‹Ø§ Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙˆØ·Ù†ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©.

     ÙˆÙ†Ø¤ÙƒØ¯ Ø§Ø¹ØªØ²Ø§Ø²Ù†Ø§ Ø¨Ø§Ù„Ø´Ø±Ø§ÙƒØ© Ù…Ø¹ Ø¥Ø¯Ø§Ø±ØªÙƒÙ… Ø§Ù„Ù…ÙˆÙ‚Ø±Ø©ØŒ ÙˆÙ†ØªØ·Ù„Ø¹ Ø¥Ù„Ù‰ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„Ù…Ø«Ù…Ø± ÙÙŠ Ø³Ø¨ÙŠÙ„ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù†ÙˆØ¹ÙŠØ©ØŒ Ø¨Ù…Ø§ ÙŠØ®Ø¯Ù… ØªØ·Ù„Ø¹Ø§Øª Ø§Ù„ÙˆØ·Ù† ÙˆÙŠØ¹Ø²Ø² Ù…ÙƒØ§Ù†ØªÙ‡ Ø§Ù„Ø±ÙŠØ§Ø¯ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ¦Ø©.

     Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø£Ùˆ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ ÙŠÙØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø²ÙŠØ§Ø¯ ÙˆØ§Ø¦Ù„ØŒ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ziad@moe.gov.sa.

ÙˆØªÙØ¶Ù„ÙˆØ§ Ø¨Ù‚Ø¨ÙˆÙ„ ÙØ§Ø¦Ù‚ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±ØŒØŒØŒ
For troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/OUTPUT_PARSING_FAILURE 
2025-11-05 10:42:52,402 - src.utils.exceptions - ERROR - Operation failed: letter_generation
2025-11-05 10:42:52,402 - src.utils.helpers - ERROR - generate_letter failed after 12.893s: Failed to generate letter: Invalid json output: Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…

Ø®Ø·Ø§Ø¨ Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ± Ù„Ø¬Ù‡ÙˆØ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©

Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„ÙØ§Ø¶Ù„ Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ                                                                                   Ø³Ù„Ù…Ù‡ Ø§Ù„Ù„Ù‡

Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ

     Ù†Ø«Ù…Ù† Ø¬Ù‡ÙˆØ¯ÙƒÙ… Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø© ÙÙŠ ØªØ·ÙˆÙŠØ± Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ ÙˆÙ†Ù‚Ø¯Ø± Ø¯ÙˆØ±ÙƒÙ… Ø§Ù„ÙØ§Ø¹Ù„ ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„ØªÙ†Ù…ÙˆÙŠØ© Ø°Ø§Øª Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹.

     ÙˆØ§Ù†Ø·Ù„Ø§Ù‚Ù‹Ø§ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù‡Ø¬ Ø§Ù„Ø·Ù…ÙˆØ­ØŒ Ù†ÙˆØ¯ Ø£Ù† Ù†Ù‚Ø¯Ù… Ù„Ø³Ø¹Ø§Ø¯ØªÙƒÙ… "Ù†Øª Ø²ÙŠØ±Ùˆ"ØŒ ÙˆÙ‡Ùˆ Ù…Ø´Ø±ÙˆØ¹ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ ÙˆØ·Ù†ÙŠØŒ Ø£Ø­Ø¯ Ù…Ø®Ø±Ø¬Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ø¬ (Ø³Ø¯Ø±Ø©) Ø§Ù„ØªØ§Ø¨Ø¹ Ù„ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…ÙŠØ§Ù‡ ÙˆØ§Ù„Ø²Ø±Ø§Ø¹Ø©ØŒ ÙŠÙ‡Ø¯Ù Ø¥Ù„Ù‰ ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© ÙˆØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø­ÙŠØ§Ø¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†ÙŠ ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŒ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ·ÙˆÙŠØ± Ø­Ù„ÙˆÙ„ ØªÙ‚Ù†ÙŠØ© Ù…Ø¨ØªÙƒØ±Ø© ØªØ¯Ø¹Ù… Ø§Ù„ØªØ´Ø¬ÙŠØ± Ø§Ù„Ø°ÙƒÙŠØŒ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ù†Ø¨Ø§ØªÙŠØŒ ÙˆØ±ÙØ¹ ÙƒÙØ§Ø¡Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¨Ù…Ø§ ÙŠÙˆØ§ÙƒØ¨ Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ù…Ù„ÙƒØ© 2030 ÙˆÙ…Ø¨Ø§Ø¯Ø±Ø© "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡".

     Ù†ØªÙ‚Ø¯Ù… Ø¥Ù„Ù‰ Ø³Ø¹Ø§Ø¯ØªÙƒÙ… Ø¨Ø¬Ø²ÙŠÙ„ Ø§Ù„Ø´ÙƒØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ± Ø¹Ù„Ù‰ Ù…Ø§ ØªØ¨Ø°Ù„ÙˆÙ†Ù‡ Ù…Ù† Ø¬Ù‡ÙˆØ¯ Ù…Ù„Ù…ÙˆØ³Ø© ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©ØŒ ÙˆØ­Ø±ØµÙƒÙ… Ø§Ù„Ø¯Ø§Ø¦Ù… Ø¹Ù„Ù‰ ØªØ³Ù‡ÙŠÙ„ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø®ØªØµØ©ØŒ Ù…Ù…Ø§ ÙƒØ§Ù† Ù„Ù‡ Ø¨Ø§Ù„Øº Ø§Ù„Ø£Ø«Ø± ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©. Ø¥Ù† ØªØ¹Ø§ÙˆÙ†ÙƒÙ… Ø§Ù„Ø¨Ù†Ù‘Ø§Ø¡ ÙˆØªÙˆØ¬ÙŠÙ‡Ø§ØªÙƒÙ… Ø§Ù„Ø³Ø¯ÙŠØ¯Ø© Ø£Ø³Ù‡Ù…Ø§ ÙÙŠ ØªØ°Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª ÙˆØªØ¹Ø²ÙŠØ² Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø°ÙŠ Ø§Ù†Ø¹ÙƒØ³ Ø¥ÙŠØ¬Ø§Ø¨Ù‹Ø§ Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙˆØ·Ù†ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©.

     ÙˆÙ†Ø¤ÙƒØ¯ Ø§Ø¹ØªØ²Ø§Ø²Ù†Ø§ Ø¨Ø§Ù„Ø´Ø±Ø§ÙƒØ© Ù…Ø¹ Ø¥Ø¯Ø§Ø±ØªÙƒÙ… Ø§Ù„Ù…ÙˆÙ‚Ø±Ø©ØŒ ÙˆÙ†ØªØ·Ù„Ø¹ Ø¥Ù„Ù‰ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„Ù…Ø«Ù…Ø± ÙÙŠ Ø³Ø¨ÙŠÙ„ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù†ÙˆØ¹ÙŠØ©ØŒ Ø¨Ù…Ø§ ÙŠØ®Ø¯Ù… ØªØ·Ù„Ø¹Ø§Øª Ø§Ù„ÙˆØ·Ù† ÙˆÙŠØ¹Ø²Ø² Ù…ÙƒØ§Ù†ØªÙ‡ Ø§Ù„Ø±ÙŠØ§Ø¯ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ¦Ø©.

     Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø£Ùˆ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ ÙŠÙØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø²ÙŠØ§Ø¯ ÙˆØ§Ø¦Ù„ØŒ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ziad@moe.gov.sa.

ÙˆØªÙØ¶Ù„ÙˆØ§ Ø¨Ù‚Ø¨ÙˆÙ„ ÙØ§Ø¦Ù‚ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±ØŒØŒØŒ
For troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/OUTPUT_PARSING_FAILURE 
2025-11-05 10:42:52,403 - src.api.letter_routes - ERROR - Letter generation failed: AI service error: Failed to generate letter: Invalid json output: Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…

Ø®Ø·Ø§Ø¨ Ø´ÙƒØ± ÙˆØªÙ‚Ø¯ÙŠØ± Ù„Ø¬Ù‡ÙˆØ¯ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©

Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„ÙØ§Ø¶Ù„ Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ                                                                                   Ø³Ù„Ù…Ù‡ Ø§Ù„Ù„Ù‡

Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ

     Ù†Ø«Ù…Ù† Ø¬Ù‡ÙˆØ¯ÙƒÙ… Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø© ÙÙŠ ØªØ·ÙˆÙŠØ± Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ ÙˆÙ†Ù‚Ø¯Ø± Ø¯ÙˆØ±ÙƒÙ… Ø§Ù„ÙØ§Ø¹Ù„ ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„ØªÙ†Ù…ÙˆÙŠØ© Ø°Ø§Øª Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹.

     ÙˆØ§Ù†Ø·Ù„Ø§Ù‚Ù‹Ø§ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†Ù‡Ø¬ Ø§Ù„Ø·Ù…ÙˆØ­ØŒ Ù†ÙˆØ¯ Ø£Ù† Ù†Ù‚Ø¯Ù… Ù„Ø³Ø¹Ø§Ø¯ØªÙƒÙ… "Ù†Øª Ø²ÙŠØ±Ùˆ"ØŒ ÙˆÙ‡Ùˆ Ù…Ø´Ø±ÙˆØ¹ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ ÙˆØ·Ù†ÙŠØŒ Ø£Ø­Ø¯ Ù…Ø®Ø±Ø¬Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ø¬ (Ø³Ø¯Ø±Ø©) Ø§Ù„ØªØ§Ø¨Ø¹ Ù„ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…ÙŠØ§Ù‡ ÙˆØ§Ù„Ø²Ø±Ø§Ø¹Ø©ØŒ ÙŠÙ‡Ø¯Ù Ø¥Ù„Ù‰ ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© ÙˆØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø­ÙŠØ§Ø¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ†ÙŠ ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŒ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ·ÙˆÙŠØ± Ø­Ù„ÙˆÙ„ ØªÙ‚Ù†ÙŠØ© Ù…Ø¨ØªÙƒØ±Ø© ØªØ¯Ø¹Ù… Ø§Ù„ØªØ´Ø¬ÙŠØ± Ø§Ù„Ø°ÙƒÙŠØŒ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ù†Ø¨Ø§ØªÙŠØŒ ÙˆØ±ÙØ¹ ÙƒÙØ§Ø¡Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¨Ù…Ø§ ÙŠÙˆØ§ÙƒØ¨ Ù…Ø³ØªÙ‡Ø¯ÙØ§Øª Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ù…Ù„ÙƒØ© 2030 ÙˆÙ…Ø¨Ø§Ø¯Ø±Ø© "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡".

     Ù†ØªÙ‚Ø¯Ù… Ø¥Ù„Ù‰ Ø³Ø¹Ø§Ø¯ØªÙƒÙ… Ø¨Ø¬Ø²ÙŠÙ„ Ø§Ù„Ø´ÙƒØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ± Ø¹Ù„Ù‰ Ù…Ø§ ØªØ¨Ø°Ù„ÙˆÙ†Ù‡ Ù…Ù† Ø¬Ù‡ÙˆØ¯ Ù…Ù„Ù…ÙˆØ³Ø© ÙÙŠ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©ØŒ ÙˆØ­Ø±ØµÙƒÙ… Ø§Ù„Ø¯Ø§Ø¦Ù… Ø¹Ù„Ù‰ ØªØ³Ù‡ÙŠÙ„ Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…Ø®ØªØµØ©ØŒ Ù…Ù…Ø§ ÙƒØ§Ù† Ù„Ù‡ Ø¨Ø§Ù„Øº Ø§Ù„Ø£Ø«Ø± ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©. Ø¥Ù† ØªØ¹Ø§ÙˆÙ†ÙƒÙ… Ø§Ù„Ø¨Ù†Ù‘Ø§Ø¡ ÙˆØªÙˆØ¬ÙŠÙ‡Ø§ØªÙƒÙ… Ø§Ù„Ø³Ø¯ÙŠØ¯Ø© Ø£Ø³Ù‡Ù…Ø§ ÙÙŠ ØªØ°Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª ÙˆØªØ¹Ø²ÙŠØ² Ø¬ÙˆØ¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø°ÙŠ Ø§Ù†Ø¹ÙƒØ³ Ø¥ÙŠØ¬Ø§Ø¨Ù‹Ø§ Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙˆØ·Ù†ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©.

     ÙˆÙ†Ø¤ÙƒØ¯ Ø§Ø¹ØªØ²Ø§Ø²Ù†Ø§ Ø¨Ø§Ù„Ø´Ø±Ø§ÙƒØ© Ù…Ø¹ Ø¥Ø¯Ø§Ø±ØªÙƒÙ… Ø§Ù„Ù…ÙˆÙ‚Ø±Ø©ØŒ ÙˆÙ†ØªØ·Ù„Ø¹ Ø¥Ù„Ù‰ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„Ù…Ø«Ù…Ø± ÙÙŠ Ø³Ø¨ÙŠÙ„ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„Ù†ÙˆØ¹ÙŠØ©ØŒ Ø¨Ù…Ø§ ÙŠØ®Ø¯Ù… ØªØ·Ù„Ø¹Ø§Øª Ø§Ù„ÙˆØ·Ù† ÙˆÙŠØ¹Ø²Ø² Ù…ÙƒØ§Ù†ØªÙ‡ Ø§Ù„Ø±ÙŠØ§Ø¯ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ¦Ø©.

     Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø£Ùˆ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ ÙŠÙØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø²ÙŠØ§Ø¯ ÙˆØ§Ø¦Ù„ØŒ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ziad@moe.gov.sa.

ÙˆØªÙØ¶Ù„ÙˆØ§ Ø¨Ù‚Ø¨ÙˆÙ„ ÙØ§Ø¦Ù‚ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±ØŒØŒØŒ
For troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/OUTPUT_PARSING_FAILURE 
2025-11-05 10:42:52,403 - src.utils.helpers - INFO - generate_letter executed in 24.721s
2025-11-05 10:42:52,404 - __main__ - INFO - Response: 500 - letter.generate_letter
2025-11-05 10:42:52,404 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 10:42:52] "[35m[1mPOST /api/v1/letter/generate HTTP/1.1[0m" 500 -
2025-11-05 10:44:49,872 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/letter/generate - 127.0.0.1
2025-11-05 10:44:49,872 - src.api.letter_routes - INFO - Letter generation request from user: ziad@moe.gov.sa, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:44:51,353 - src.services.usage_tracking_service - INFO - Found quota_month limit: 100
2025-11-05 10:44:51,371 - src.utils.helpers - INFO - get_quota_limit executed in 1.498s
2025-11-05 10:44:53,855 - src.services.usage_tracking_service - INFO - Found existing usage row for 2025_11 at row 3: {'yyyy_mm': '2025_11', 'letters_count': 3, 'tokens_sum': 8361, 'cost_sum_usd': 0.054525}
2025-11-05 10:44:53,856 - src.utils.helpers - INFO - get_or_create_usage_row executed in 2.484s
2025-11-05 10:44:53,856 - src.services.usage_tracking_service - INFO - Quota check passed: 3/100 (97 remaining)
2025-11-05 10:44:53,856 - src.utils.helpers - INFO - check_quota executed in 3.983s
2025-11-05 10:44:53,856 - src.utils.helpers - INFO - get_client_by_email executed in 0.000s
2025-11-05 10:44:55,888 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 1.062s
2025-11-05 10:44:56,264 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 1.435s
2025-11-05 10:44:56,336 - src.services.google_services - WARNING - No user found with full_name: 
2025-11-05 10:44:56,347 - src.utils.helpers - INFO - get_data_by_key_from_sheet_id executed in 1.513s
2025-11-05 10:44:56,579 - src.utils.helpers - INFO - get_user_info_from_sheet_id executed in 1.742s
2025-11-05 10:44:56,580 - src.utils.helpers - INFO - get_letter_config_by_category_from_sheet_id executed in 1.759s
2025-11-05 10:44:56,580 - src.api.letter_routes - INFO - Loaded letter config from sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg for category: Ø·Ù„Ø¨
2025-11-05 10:44:56,581 - src.services.letter_generator - INFO - Attempting to load prompt template from Settings sheet for sheet_id: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 10:44:57,520 - src.services.usage_tracking_service - INFO - Found prompt template from Settings sheet (length: 7359 chars)
2025-11-05 10:44:57,521 - src.utils.helpers - INFO - get_prompt_template executed in 0.940s
2025-11-05 10:44:57,521 - src.services.letter_generator - INFO - âœ… Successfully loaded custom prompt template from Settings sheet (length: 7359 chars)
2025-11-05 10:44:58,418 - src.utils.helpers - INFO - get_context_instructions executed in 0.895s
2025-11-05 10:44:58,442 - src.services.letter_generator - INFO - Retrieved memory instructions for category='Ø·Ù„Ø¨', session_id='None', sheet_id='17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg': 125 chars
2025-11-05 10:44:58,442 - src.services.letter_generator - INFO - Generating letter with ID: LET-20251105-45834
2025-11-05 10:45:09,125 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 10:45:09,135 - src.services.letter_generator - INFO - Letter generated successfully: LET-20251105-45834
2025-11-05 10:45:09,135 - src.utils.helpers - INFO - generate_letter executed in 12.554s
2025-11-05 10:45:09,135 - src.api.letter_routes - INFO - Letter generated successfully: LET-20251105-45834
2025-11-05 10:45:09,135 - src.services.letter_generator - INFO - Using default hardcoded prompt template
2025-11-05 10:45:10,392 - src.utils.helpers - INFO - get_context_instructions executed in 1.256s
2025-11-05 10:45:10,411 - src.services.letter_generator - INFO - Retrieved memory instructions for category='Ø·Ù„Ø¨', session_id='None', sheet_id='17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg': 125 chars
2025-11-05 10:45:10,418 - src.services.usage_tracking_service - INFO - Usage estimate: 5758 tokens ($0.037070)
2025-11-05 10:45:11,329 - src.services.usage_tracking_service - INFO - Found existing usage row for 2025_11 at row 3: {'yyyy_mm': '2025_11', 'letters_count': 3, 'tokens_sum': 8361, 'cost_sum_usd': 0.054525}
2025-11-05 10:45:11,329 - src.utils.helpers - INFO - get_or_create_usage_row executed in 0.911s
2025-11-05 10:45:14,270 - src.services.usage_tracking_service - INFO - Updated usage for 2025_11: letters=4, tokens=14119, cost=$0.091595
2025-11-05 10:45:14,270 - src.utils.helpers - INFO - update_usage executed in 3.852s
2025-11-05 10:45:14,270 - src.api.letter_routes - INFO - Usage tracked for letter LET-20251105-45834: 5758 tokens, $0.037070
2025-11-05 10:45:14,271 - src.utils.helpers - INFO - generate_letter executed in 24.398s
2025-11-05 10:45:14,271 - __main__ - INFO - Response: 200 - letter.generate_letter
2025-11-05 10:45:14,272 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 10:45:14] "POST /api/v1/letter/generate HTTP/1.1" 200 -
2025-11-05 12:16:32,012 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:16:32,084 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.11:5000
2025-11-05 12:16:32,085 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-05 12:16:32,086 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:16:34,411 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:16:34,432 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:16:34,435 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:16:52,193 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:16:52,193 - src.utils.helpers - WARNING - No authorization token found in request
2025-11-05 12:16:52,194 - src.utils.helpers - INFO - archive_letter_docx executed in 0.001s
2025-11-05 12:16:52,194 - __main__ - INFO - Response: 401 - archive.archive_letter_docx
2025-11-05 12:16:52,194 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:16:52] "[31m[1mPOST /api/v1/archive/letter/docx HTTP/1.1[0m" 401 -
2025-11-05 12:17:05,982 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/user/validate - 127.0.0.1
2025-11-05 12:17:08,555 - src.services.user_management_service - INFO - Client found for email ziad@moe.gov.sa: Ministry of Education
2025-11-05 12:17:08,555 - src.utils.helpers - INFO - get_client_by_email executed in 2.572s
2025-11-05 12:17:09,651 - src.services.user_management_service - INFO - User found: ziad@moe.gov.sa in client sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 12:17:09,652 - src.utils.helpers - INFO - get_user_info executed in 1.097s
2025-11-05 12:17:09,722 - src.services.user_management_service - INFO - User credentials validated successfully: ziad@moe.gov.sa for client Ministry of Education
2025-11-05 12:17:09,722 - src.utils.helpers - INFO - validate_user_credentials executed in 3.739s
2025-11-05 12:17:09,722 - src.api.user_routes - INFO - User validated successfully: ziad@moe.gov.sa
2025-11-05 12:17:09,723 - src.utils.helpers - INFO - validate_user executed in 3.741s
2025-11-05 12:17:09,723 - __main__ - INFO - Response: 200 - user.validate_user
2025-11-05 12:17:09,723 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:17:09] "POST /api/v1/user/validate HTTP/1.1" 200 -
2025-11-05 12:17:29,473 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:17:29,473 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 12:17:29,473 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 12:17:29,473 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 12:17:29,474 - src.utils.helpers - INFO - archive_letter_docx executed in 0.001s
2025-11-05 12:17:29,474 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 12:17:29,474 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 12:17:29,474 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 12:17:29,474 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:17:29] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 12:17:29,474 - src.services.doc_services - INFO - Using template at: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:17:29,876 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 12:17:37,890 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 12:17:37,920 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 12:17:37,920 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 12:17:37,938 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:17:37,942 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 12:17:37,955 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:17:37,955 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:17:37,955 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 12:17:37,955 - src.api.archive_routes - ERROR - [DOCX BACKGROUND] ERROR during archive/upload: DriveLoggerService.save_letter_to_drive_and_log() got an unexpected keyword argument 'file_type'
Traceback (most recent call last):
  File "D:\shobbak\AutomatingLetter\src\api\archive_routes.py", line 424, in process_letter_docx_archive_in_background
    archive_result = drive_logger.save_letter_to_drive_and_log(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DriveLoggerService.save_letter_to_drive_and_log() got an unexpected keyword argument 'file_type'
2025-11-05 12:17:37,957 - src.api.archive_routes - ERROR - [DOCX BACKGROUND] âŒ CRITICAL ERROR in background DOCX archiving for letter ID LET-202510sdfsd23: DriveLoggerService.save_letter_to_drive_and_log() got an unexpected keyword argument 'file_type'
Traceback (most recent call last):
  File "D:\shobbak\AutomatingLetter\src\api\archive_routes.py", line 424, in process_letter_docx_archive_in_background
    archive_result = drive_logger.save_letter_to_drive_and_log(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: DriveLoggerService.save_letter_to_drive_and_log() got an unexpected keyword argument 'file_type'
2025-11-05 12:18:28,933 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\api\\archive_routes.py', reloading
2025-11-05 12:18:29,260 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:18:31,820 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:18:31,843 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:18:31,846 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:18:36,340 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\drive_logger.py', reloading
2025-11-05 12:18:36,564 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:18:38,594 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:18:38,617 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:18:38,620 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:18:44,224 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\drive_logger.py', reloading
2025-11-05 12:18:44,422 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:18:46,877 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:18:46,898 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:18:46,901 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:19:04,485 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\drive_logger.py', reloading
2025-11-05 12:19:04,674 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:19:07,107 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:19:07,128 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:19:07,131 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:19:25,407 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:19:25,408 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 12:19:25,411 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 12:19:25,411 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 12:19:25,412 - src.utils.helpers - INFO - archive_letter_docx executed in 0.003s
2025-11-05 12:19:25,412 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 12:19:25,412 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 12:19:25,412 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 12:19:25,413 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:19:25] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 12:19:25,413 - src.services.doc_services - INFO - Using template at: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:19:25,923 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 12:19:30,967 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 12:19:30,993 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 12:19:30,994 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 12:19:30,999 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:19:31,004 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 12:19:31,018 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:19:31,019 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:19:31,019 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 12:19:31,024 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-11-05 12:19:34,487 - src.services.drive_logger - INFO - File uploaded to Drive: Invitation Letter_LET-202510sdfsd23.docx (ID: 15nIIhufT5g7BotHNB1Cy6lFPkFXZeg7S)
2025-11-05 12:19:36,866 - src.services.google_services - INFO - Successfully logged 1 entries to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, worksheet 'Submissions'
2025-11-05 12:19:36,866 - src.utils.helpers - INFO - log_entries_by_id executed in 2.379s
2025-11-05 12:19:36,866 - src.services.drive_logger - INFO - Successfully archived DOCX letter LET-202510sdfsd23 to Drive and logged to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 12:19:36,867 - src.api.archive_routes - INFO - [DOCX BACKGROUND] âœ… Background DOCX archiving completed successfully for letter ID: LET-202510sdfsd23
2025-11-05 12:19:36,867 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Drive URL: https://docs.google.com/document/d/15nIIhufT5g7BotHNB1Cy6lFPkFXZeg7S/edit?usp=drivesdk&ouid=110299286448075581316&rtpof=true&sd=true
2025-11-05 12:21:05,904 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:21:07,005 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:21:10,059 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:21:10,090 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:21:10,102 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:21:34,469 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:21:34,469 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 12:21:34,469 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 12:21:34,469 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 12:21:34,469 - src.utils.helpers - INFO - archive_letter_docx executed in 0.000s
2025-11-05 12:21:34,469 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 12:21:34,469 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 12:21:34,469 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 12:21:34,469 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:21:34] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 12:21:34,469 - src.services.doc_services - INFO - Using template at: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:21:34,936 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 12:21:41,943 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 12:21:41,972 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 12:21:41,972 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 12:21:41,977 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:21:41,983 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 12:21:41,997 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:21:41,997 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:21:41,998 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 12:21:42,005 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-11-05 12:21:45,707 - src.services.drive_logger - INFO - File uploaded to Drive: Invitation Letter_LET-202510sdfsd23.docx (ID: 1QM1J4-dlaEU9Ov5SgvpPrc9TAJK-vWme)
2025-11-05 12:21:48,378 - src.services.google_services - INFO - Successfully logged 1 entries to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, worksheet 'Submissions'
2025-11-05 12:21:48,378 - src.utils.helpers - INFO - log_entries_by_id executed in 2.671s
2025-11-05 12:21:48,378 - src.services.drive_logger - INFO - Successfully archived DOCX letter LET-202510sdfsd23 to Drive and logged to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 12:21:48,379 - src.api.archive_routes - INFO - [DOCX BACKGROUND] âœ… Background DOCX archiving completed successfully for letter ID: LET-202510sdfsd23
2025-11-05 12:21:48,379 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Drive URL: https://docs.google.com/document/d/1QM1J4-dlaEU9Ov5SgvpPrc9TAJK-vWme/edit?usp=drivesdk&ouid=110299286448075581316&rtpof=true&sd=true
2025-11-05 12:23:37,382 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:23:37,781 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:23:40,156 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:23:40,180 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:23:40,183 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:23:46,876 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:23:47,094 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:23:49,806 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:23:49,948 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:23:49,949 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:23:55,541 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:23:55,762 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:23:58,761 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:23:58,790 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:23:58,793 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:24:09,858 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:24:10,048 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:24:12,798 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:24:12,827 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:24:12,830 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:24:17,321 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:24:17,540 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:24:19,841 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:24:19,875 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:24:19,878 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:24:54,579 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:24:54,579 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 12:24:54,579 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 12:24:54,579 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 12:24:54,579 - src.utils.helpers - INFO - archive_letter_docx executed in 0.000s
2025-11-05 12:24:54,579 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 12:24:54,579 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 12:24:54,579 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 12:24:54,579 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:24:54] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 12:24:54,579 - src.services.doc_services - INFO - Using template at: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:24:54,907 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 12:25:01,212 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 12:25:01,231 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 12:25:01,231 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 12:25:01,237 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:25:05,086 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 12:25:05,098 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:25:05,098 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:25:05,100 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 12:25:05,104 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-11-05 12:25:08,696 - src.services.drive_logger - INFO - File uploaded to Drive: Invitation Letter_LET-202510sdfsd23.docx (ID: 11z5ODkyivoNbcdzce51JkqP50M8TtxQy)
2025-11-05 12:25:10,427 - src.services.google_services - INFO - Successfully logged 1 entries to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, worksheet 'Submissions'
2025-11-05 12:25:10,427 - src.utils.helpers - INFO - log_entries_by_id executed in 1.731s
2025-11-05 12:25:10,427 - src.services.drive_logger - INFO - Successfully archived DOCX letter LET-202510sdfsd23 to Drive and logged to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 12:25:10,428 - src.api.archive_routes - INFO - [DOCX BACKGROUND] âœ… Background DOCX archiving completed successfully for letter ID: LET-202510sdfsd23
2025-11-05 12:25:10,428 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Drive URL: https://docs.google.com/document/d/11z5ODkyivoNbcdzce51JkqP50M8TtxQy/edit?usp=drivesdk&ouid=110299286448075581316&rtpof=true&sd=true
2025-11-05 12:25:48,392 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:25:48,839 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:25:54,770 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:25:54,804 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:25:54,807 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:26:01,530 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:26:01,751 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:26:04,003 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:26:04,025 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:26:04,028 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:26:05,303 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:26:05,508 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:26:07,977 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:26:08,003 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:26:08,003 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:26:15,752 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:26:15,969 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:26:18,845 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:26:18,866 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:26:18,869 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:26:20,468 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:26:20,468 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 12:26:20,468 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 12:26:20,468 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 12:26:20,473 - src.utils.helpers - INFO - archive_letter_docx executed in 0.005s
2025-11-05 12:26:20,473 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 12:26:20,473 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 12:26:20,473 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 12:26:20,473 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:26:20] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 12:26:20,473 - src.services.doc_services - INFO - Using template at: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:26:21,168 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 12:26:28,780 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 12:26:28,804 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 12:26:28,804 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 12:26:28,823 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:26:33,786 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 12:26:33,792 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:26:33,792 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:26:33,792 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 12:26:33,819 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-11-05 12:26:38,668 - src.services.drive_logger - INFO - File uploaded to Drive: Invitation Letter_LET-202510sdfsd23.docx (ID: 13DohbA2RO61ATP70ujUsRnTb2eupZ2ct)
2025-11-05 12:26:40,351 - src.services.google_services - INFO - Successfully logged 1 entries to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, worksheet 'Submissions'
2025-11-05 12:26:40,351 - src.utils.helpers - INFO - log_entries_by_id executed in 1.682s
2025-11-05 12:26:40,351 - src.services.drive_logger - INFO - Successfully archived DOCX letter LET-202510sdfsd23 to Drive and logged to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 12:26:40,353 - src.api.archive_routes - INFO - [DOCX BACKGROUND] âœ… Background DOCX archiving completed successfully for letter ID: LET-202510sdfsd23
2025-11-05 12:26:40,353 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Drive URL: https://docs.google.com/document/d/13DohbA2RO61ATP70ujUsRnTb2eupZ2ct/edit?usp=drivesdk&ouid=110299286448075581316&rtpof=true&sd=true
2025-11-05 12:28:20,002 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:28:20,859 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:28:23,466 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:28:23,496 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:28:23,496 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:28:44,634 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:28:44,637 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 12:28:44,638 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 12:28:44,638 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 12:28:44,638 - src.utils.helpers - INFO - archive_letter_docx executed in 0.001s
2025-11-05 12:28:44,638 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 12:28:44,639 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 12:28:44,639 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 12:28:44,639 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:28:44] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 12:28:44,640 - src.services.doc_services - INFO - Using template at: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:28:45,001 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 12:28:55,877 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 12:28:55,903 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 12:28:55,903 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 12:28:55,909 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:28:56,041 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 12:28:56,055 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:28:56,056 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:28:56,056 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 12:28:56,061 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-11-05 12:28:59,752 - src.services.drive_logger - INFO - File uploaded to Drive: Invitation Letter_LET-202510sdfsd23.docx (ID: 1_kauPZ24RXxuF7tqRI1ftTadnH4EQpsi)
2025-11-05 12:29:03,334 - src.services.google_services - INFO - Successfully logged 1 entries to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, worksheet 'Submissions'
2025-11-05 12:29:03,334 - src.utils.helpers - INFO - log_entries_by_id executed in 3.582s
2025-11-05 12:29:03,334 - src.services.drive_logger - INFO - Successfully archived DOCX letter LET-202510sdfsd23 to Drive and logged to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 12:29:03,335 - src.api.archive_routes - INFO - [DOCX BACKGROUND] âœ… Background DOCX archiving completed successfully for letter ID: LET-202510sdfsd23
2025-11-05 12:29:03,335 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Drive URL: https://docs.google.com/document/d/1_kauPZ24RXxuF7tqRI1ftTadnH4EQpsi/edit?usp=drivesdk&ouid=110299286448075581316&rtpof=true&sd=true
2025-11-05 12:33:25,351 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:33:25,694 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:33:28,366 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:33:28,392 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:33:28,397 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:33:42,787 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:33:42,998 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:33:45,485 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:33:45,505 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:33:45,508 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:33:47,862 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:33:48,058 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:33:50,202 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:33:50,225 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:33:50,228 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:33:51,533 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:33:51,753 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:33:53,949 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:33:53,973 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:33:53,976 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 12:33:56,891 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 12:33:56,892 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 12:33:56,892 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 12:33:56,892 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 12:33:56,893 - src.utils.helpers - INFO - archive_letter_docx executed in 0.001s
2025-11-05 12:33:56,893 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 12:33:56,893 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 12:33:56] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 12:33:56,894 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 12:33:56,894 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 12:33:56,894 - src.services.doc_services - INFO - Using template at: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:33:57,354 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 12:34:03,557 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 12:34:03,583 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 12:34:03,584 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 12:34:03,591 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 12:34:03,711 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 12:34:03,723 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:34:03,723 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 12:34:03,726 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 12:34:03,733 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-11-05 12:34:07,245 - src.services.drive_logger - INFO - File uploaded to Drive: Invitation Letter_LET-202510sdfsd23.docx (ID: 1LEUEj0ihhFw_hGTUw8Yr6blB-gdtr0I7)
2025-11-05 12:34:09,455 - src.services.google_services - INFO - Successfully logged 1 entries to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, worksheet 'Submissions'
2025-11-05 12:34:09,455 - src.utils.helpers - INFO - log_entries_by_id executed in 2.209s
2025-11-05 12:34:09,455 - src.services.drive_logger - INFO - Successfully archived DOCX letter LET-202510sdfsd23 to Drive and logged to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 12:34:09,456 - src.api.archive_routes - INFO - [DOCX BACKGROUND] âœ… Background DOCX archiving completed successfully for letter ID: LET-202510sdfsd23
2025-11-05 12:34:09,456 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Drive URL: https://docs.google.com/document/d/1LEUEj0ihhFw_hGTUw8Yr6blB-gdtr0I7/edit?usp=drivesdk&ouid=110299286448075581316&rtpof=true&sd=true
2025-11-05 12:35:02,714 - werkzeug - INFO -  * Detected change in 'D:\\shobbak\\AutomatingLetter\\src\\services\\doc_services.py', reloading
2025-11-05 12:35:03,083 - werkzeug - INFO -  * Restarting with stat
2025-11-05 12:35:05,416 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 12:35:05,438 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 12:35:05,443 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 14:59:15,796 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 14:59:15,836 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.11:5000
2025-11-05 14:59:15,837 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-11-05 14:59:15,838 - werkzeug - INFO -  * Restarting with stat
2025-11-05 14:59:18,040 - root - INFO - Logging initialized: logs/app.log (time-based rotation, 30 day retention)
2025-11-05 14:59:18,076 - werkzeug - WARNING -  * Debugger is active!
2025-11-05 14:59:18,079 - werkzeug - INFO -  * Debugger PIN: 129-536-069
2025-11-05 14:59:21,290 - __main__ - INFO - POST http://127.0.0.1:5000/api/v1/archive/letter/docx - 127.0.0.1
2025-11-05 14:59:21,290 - src.api.archive_routes - INFO - DOCX Archive request from user: ziad@moe.gov.sa, client: CLI-002, sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, drive: 1Ckh0fh4qFSZZnNxc57Ads6HDVmHTM1wU
2025-11-05 14:59:21,291 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Starting background DOCX archiving for letter ID: LET-202510sdfsd23
2025-11-05 14:59:21,291 - src.api.archive_routes - INFO - Letter DOCX archiving initiated for ID: LET-202510sdfsd23 (sheet: 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg)
2025-11-05 14:59:21,292 - src.utils.helpers - INFO - archive_letter_docx executed in 0.002s
2025-11-05 14:59:21,292 - __main__ - INFO - Response: 200 - archive.archive_letter_docx
2025-11-05 14:59:21,292 - src.services.drive_logger - INFO - Drive Logger service initialized
2025-11-05 14:59:21,293 - werkzeug - INFO - 127.0.0.1 - - [05/Nov/2025 14:59:21] "POST /api/v1/archive/letter/docx HTTP/1.1" 200 -
2025-11-05 14:59:21,293 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Creating DOCX document for letter ID: LET-202510sdfsd23
2025-11-05 14:59:21,294 - src.services.doc_services - INFO - Using default template path: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 14:59:21,575 - src.services.doc_services - INFO - Starting raw letter content parsing with GPT-4o
2025-11-05 14:59:27,388 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-05 14:59:27,408 - src.services.doc_services - INFO - Letter content parsed successfully
2025-11-05 14:59:27,408 - src.services.doc_services - INFO - Document letter ID set to: LET-202510sdfsd23
2025-11-05 14:59:27,414 - src.services.doc_services - INFO - Template loaded successfully from: D:\shobbak\AutomatingLetter\LetterToPdf\templates\Netzero.docx
2025-11-05 14:59:27,534 - src.services.doc_services - INFO - Document created successfully from JSON (Letter ID: LET-202510sdfsd23)
2025-11-05 14:59:27,549 - src.services.doc_services - INFO - Document saved successfully to: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 14:59:27,550 - src.api.archive_routes - INFO - [DOCX BACKGROUND] DOCX generated successfully: C:\Users\ZIAD~1.ABD\AppData\Local\Temp\Invitation Letter_LET-202510sdfsd23.docx
2025-11-05 14:59:27,550 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Uploading DOCX to Drive and logging for letter ID: LET-202510sdfsd23
2025-11-05 14:59:27,555 - googleapiclient.discovery_cache - INFO - file_cache is only supported with oauth2client<4.0.0
2025-11-05 14:59:30,935 - src.services.drive_logger - INFO - File uploaded to Drive: Invitation Letter_LET-202510sdfsd23.docx (ID: 1oyBmvkWYrdTP7K1JvHh0LMBpp4k-Q9k7)
2025-11-05 14:59:34,553 - src.services.google_services - INFO - Successfully logged 1 entries to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg, worksheet 'Submissions'
2025-11-05 14:59:34,557 - src.utils.helpers - INFO - log_entries_by_id executed in 3.622s
2025-11-05 14:59:34,557 - src.services.drive_logger - INFO - Successfully archived DOCX letter LET-202510sdfsd23 to Drive and logged to sheet 17jLMvuldHzpizbtvTYqe8Gz5UCx58mkQmjOX1INUHIg
2025-11-05 14:59:34,558 - src.api.archive_routes - INFO - [DOCX BACKGROUND] âœ… Background DOCX archiving completed successfully for letter ID: LET-202510sdfsd23
2025-11-05 14:59:34,558 - src.api.archive_routes - INFO - [DOCX BACKGROUND] Drive URL: https://docs.google.com/document/d/1oyBmvkWYrdTP7K1JvHh0LMBpp4k-Q9k7/edit?usp=drivesdk&ouid=110299286448075581316&rtpof=true&sd=true
